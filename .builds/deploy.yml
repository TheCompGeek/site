image: archlinux
packages:
  - nodejs
  - pnpm
sources:
  - https://git.sr.ht/~boehs/site
environment:
  site: boehs.org
tasks:
  - setup: |
      cd site/html
      pnpm install --frozen-lockfile
  - build: |
      cd site/html
      pnpm run build
  - artifact: |
      cd site/html/dist
      tar -cvz . > ../site.tar.gz
  - deploy: |
      cd site/html
      acurl -f https://pages.sr.ht/publish/$site -Fcontent=@site.tar.gz
artifacts:
  - site/html/site.tar.gz
